<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>NUnit &amp; the Silverlight unit test framework - Jeff Wilcox</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NUnit &amp; the Silverlight unit test framework">
    <meta name="author" content="Jeff Wilcox">
    

    <link href="http://feeds.feedburner.com/jeffwilcox" rel="alternate" title="Jeff Wilcox" type="application/atom+xml" />
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
    <link href="/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/css/jmw.css" rel="stylesheet"/>
    <script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.4.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/toc.js"></script>
    <script src="/js/jmw.js"></script>
    <link type="text/css" rel="stylesheet" href="//az414997.vo.msecnd.net/waz/syntax/styles/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="//az414997.vo.msecnd.net/waz/syntax/styles/shThemeDefault.css"/>
  </head>
<body data-spy="scroll" data-target=".wiki-sidebar">
    <div class="navbar navbar-inverse" role="navigation"><!-- formerly navbar-fixed-top -->
        <div class="navbar-inner">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">Jeff Wilcox</a>
                </div>
                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="/about/">About</a></li>
                    <li><a href="/posts/">Posts</a></li>
                    <li><a href="https://github.com/jeffwilcox">//github.com/jeffwilcox</a></li>
                    <li><a href="https://twitter.com/jeffwilcox">@jeffwilcox</a></li>
                    <li><a href="http://linkedin.com/in/jeffreywilcox">LinkedIn</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>



<div class="container">

  <div class="container">
    <div class="row">
      <div class="col-md-8">

        <div id="post">
          <h2 class="post-title"><!--<a href="/2009/01/nunit-and-silverlight/">-->NUnit &amp; the Silverlight unit test framework<!--</a>--></h2>
          <div class="pull-right">
            <a href="https://twitter.com/share" class="twitter-share-button" data-via="jeffwilcox" data-count="none">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></p>
          </div>
          <p id="date" class="muted">
            
            
            <small>
               7 January 2009
            </small>
            
            <!--
            <ul class="categories nav nav-pills">
            
            </ul>
            -->
            
          </p>

          <div class="blogcontent">
            <p>Did you know that you can run <a href="http://www.nunit.org/index.php">NUnit</a> tests with the Silverlight unit test framework? In this short guide, I talk about updating NUnit to build for Silverlight, wiring up test projects, and a download with everything you need to get started.</p>  <p>This isn't a &quot;metadata redirection&quot; trick - but the actual NUnit assertions and metadata running inside the Silverlight unit test engine. This took about 15 minutes to implement from start to finish - shorter than the amount of time it'll take me to publish this post.</p>  <p>Though NUnit is great for legacy components and tests, I strongly recommend using the <strong>built-in Visual Studio metadata</strong> for most projects. The metadata is used by enough folks throughout Microsoft and the industry to be well-supported, tested, familiar, and not require the custom unit test provider hookup in your test projects.</p>  <p>That said, I do hear about legacy business objects and NUnit tests that devs would like to be able to verify and run in the browser + Silverlight environment. </p>  <p>You can read about NUnit <a href="http://www.nunit.org/index.php?p=attributes&amp;r=2.4.8">attributes</a> and <a href="http://www.nunit.org/index.php?p=assertions&amp;r=2.4.8">assertions</a> in the official documentation. So, here goes...</p>  <h3>Running sample &amp; validation tests that ship with NUnit</h3>  <p>Inside the traditional <a href="http://www.nunit.org/index.php?p=download">NUnit source download</a>, there's a sample called &quot;Money&quot; that tests a simple interface and types. Here's that &quot;Money&quot; project running on <strong>OS X/Safari</strong>, via the Silverlight unit test framework and NUnit:</p>  <p><a href="http://media.jeff.wilcox.name/blog/ut/NUnitMoney/TestPage.html"><img src="http://media.jeff.wilcox.name/blog/ut/NUnitMoneyTest.png" /></a>&#160; <br /><em>&quot;Money&quot; sample test project: Click on the image or <a href="http://media.jeff.wilcox.name/blog/ut/NUnitMoney/TestPage.html">here to run</a> the Silverlight test application on your machine. Tests will start in ~5 seconds.</em></p>  <p>If you have a set of legacy business objects and associated NUnit tests, you'll find it easy to run them within Silverlight now.</p>  <p>To further demonstrate the compatibility here, this is the &quot;NUnitTests&quot; test project that validates the core NUnit framework and its assertions, running inside Chrome:</p>  <p><a href="http://media.jeff.wilcox.name/blog/ut/NUnitTests/TestPage.html"><img src="http://media.jeff.wilcox.name/blog/ut/NUnitTests.png" /></a>     <br /><em>&quot;NUnitTests&quot; that validate the NUnit framework. Click on the image or <a href="http://media.jeff.wilcox.name/blog/ut/NUnitTests/TestPage.html">here to run</a> the tests.</em></p>  <h3>Silverlight unit test framework is easy to extend</h3>  <p>When designing the Silverlight unit test framework, it became clear that there were three or four distinct test engine components that could be combined into a single test system. Yet, they were distinct enough to allow alternative implementations and extensions to be built.</p>  <p><img src="http://media.jeff.wilcox.name/blog/ut/TestApplicationXap.png" /></p>  <p>The typical test application .XAP file ends up containing the general Silverlight unit testing engine (that performs test execution, and is very different from typical engines in that it runs on the UI thread and is synchronous), your actual tests marked with the appropriate metadata, and then the metadata and unit test assertions that you're using.</p>  <p>Inside the unit test engine, there's a base test harness class, and then the UnitTestHarness implementation that does most of the heavy lifting. A set of interfaces abstract out the reading and processing of unit test metadata. Interfaces aren't always a great answer, but the value added in this case.</p>  <p>The metadata/assertion implementation that you use (NUnit or VSTT, for example) takes care of throwing exceptions when assertions fail, that the framework then processes in a generic way.</p>  <p>The Silverlight unit framework ships with the same metadata used in the Visual Studio team system's unit test framework, making it easy to move between desktop and Silverlight application and test development. A &quot;VsttProvider&quot; sits between the Visual Studio metadata and the actual unit test engine, and ships in the Microsoft.Silverlight.Testing assembly.</p>  <p>OK. That's a mouthful, but it means that you can implement your own metadata provider to support running other unit tests. Since NUnit and VSTT are so similar, this was easy - but more intricate frameworks might need to modify or extend the actual unit test system to provide the right experience.</p>  <h3>Getting NUnitFramework to build</h3>  <p>NUnit is relatively old; it is from a different era of .NET development. NUnit utilizes the old .NET Hashtable and ArrayList types.</p>  <p>Also, the .NET framework base class libaries included in Silverlight are a subset, rely more on .NET 3.5 features, and exclude some of the older types.</p>  <p>To easily support building NUnit with the Silverlight subset of the framework, here's the list of changes I needed to make to the NUnitFramework project:</p>  <ul>   <li>Add simple implementations of Hashtable.cs and ArrayList.cs, utilizing modern generic collections under the hood </li>    <li>Inside ConstraintBuilder.cs, update the Stack type to be a generic Stack&lt;object&gt; </li>    <li>Added a shim/empty SerializableAttribute </li>    <li>Comment out constructors in IgnoreException.cs and AssertionException.cs that were designed for serialization (lines 33-35 and 35-37, respectively) </li>    <li><em>I removed the strong name assembly attributes from AssemblyInfo.cs, this isn't actually required.</em> </li>    <li>On line 92 of CollectionConstaints.cs, changed the DictionaryEntry typed temporary variable to be of type &quot;var&quot; (since the Hashtable implementation is actually exposing a generic KeyValuePair now) </li> </ul>  <p>So, I added a small &quot;CompatibilityShims&quot; Silverlight C# library project to the solution that included Hashtable, ArrayList, and SerializableAttribute.</p>  <h3>Wiring up test applications</h3>  <p>Unlike standard NUnit test projects, you will need to create an actual <strong>Silverlight application</strong> project for your tests. Once you create a new empty app, here's what you should do:</p>  <ul>   <li>Remove the Page.xaml and Page.xaml.cs files</li>    <li>Add a reference to Microsoft.Silverlight.Testing.dll</li>    <li>Add a reference to the built NUnitFramework and NUnitSilverlight libraries and/or projects from this download</li>    <li>Inside App.xaml.cs, add using statements for the Microsoft.Silverlight.Testing and Microsoft.Silverlight.Testing.UnitTesting.Metadata.NUnit namespaces</li>    <li>Update Application_Startup per the instructions below</li>    <li>Add your tests and, if needed, a reference to your assembly/app under test</li> </ul>  <p>Here's what the startup code should look like for the test application:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px" id="scid:887EC618-8FBE-49a5-A908-2339AF2EC720:52798c07-26cc-4e07-bf53-8874727ed8ec" class="wlWriterSmartContent"><pre class="brush: c-sharp">        private void Application_Startup(object sender, StartupEventArgs e)

        {

            UnitTestSystem.RegisterUnitTestProvider(new NUnitProvider());

            RootVisual = UnitTestSystem.CreateTestPage();

        }</pre></div>



<p>The code is similar to the regular Silverlight unit test startup code that you use for VSTT tests, except it first registers the NUnitProvider.</p>



<p>You can build and run the Silverlight application like any other: just press F5 and the tests will run!</p>



<h3>Using the Silverlight test framework's asynchronous and Silverlight testing features</h3>



<p>Since the unit test engine is metadata-agnostic, it handles all the advanced asynchronous and Silverlight-specific test functions. Many of the core features specific to the Silverlight framework work with NUnit, therefore.</p>



<p>You'll find that you can use:</p>



<ul>

  <li>[Bug(...)] attributes</li>



  <li>[Tag(...)] attributes. The Category NUnit attribute isn't supported in this download, but you could easily modify the provider to expose Category data as Tags.</li>



  <li>[Asynchronous], combined with deriving from SilverlightTest: support functional testing of user interface elements and controls.</li>

</ul>



<h3>Download the bits and samples</h3>



<p>I'm offering this as a proof-of-concept, unsupported download. Inside you'll find everything that you need to explore the concept.</p>



<ul>

  <li><a href="http://media.jeff.wilcox.name/blog/ut/NUnit.Silverlight.zip"><strong>NUnit.Silverlight.zip</strong></a> [266 KB], contains:</li>



  </ul><ul>

    <li>Unit test framework binaries</li>



    <li>CompatibilityShims</li>



    <li>NUnitFramework</li>



    <li>&quot;NUnitSilverlight&quot; NUnit test provider for the Silverlight unit test framework</li>



    <li>Sample test applications: &quot;Money&quot;, &quot;NUnitTests&quot;</li>

  </ul>





<h3>Related resources</h3>



<ul>

  <li><a href="http://www.jeff.wilcox.name/2008/08/utbasics/">Visual Studio unit testing intro</a> </li>



  <li><a href="http://www.jeff.wilcox.name/2008/11/test-framework-source/">Silverlight unit test framework source released</a> </li>



  <li><a href="http://www.jeff.wilcox.name/2008/10/ut-docs/">Reference documentation for the Silverlight unit test framework</a> </li>



  <li><a href="http://www.jeff.wilcox.name/2008/09/rc0-new-test-features/">New test framework features for RC0/RTW</a> </li>



  <li><a href="http://www.jeff.wilcox.name/2008/03/silverlight2-unit-testing/">Unit testing with Silverlight 2</a> </li>

</ul>



<p>Hope this helps!</p>

          </div>
        </div>

      </div>

      <div class="col-md-4 wiki-sidebaZr" style="margin-top:18px">
            
    <p style="position: relative; width: 100%; height:195px; min-height: 120px; background: url(/jeffwilcox.png) no-repeat"></p>
    

    
<p class="lead" style="font-size:20px">
  Jeff Wilcox is a Software Engineer at Microsoft in the
  Open Source Programs Office (OSPO), helping Microsoft engineers
  use, contribute to and release open source at scale.
  
</p>
<!--
<p>
  Jeff is an alumnus of the University of Michigan, Ann Arbor, with
  a degree in Computer Science.
</p>
-->
    <p><a href="https://twitter.com/jeffwilcox" class="twitter-follow-button" data-show-count="true" data-size="medium">Follow @jeffwilcox</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></p>

    
       <div style="margin-top: 24px">
           <!-- small -->
               
           <!-- /small -->
       </div>
    

    <div id="toc" class="wiki-sidebar" style="margin-top: 24px">
    </div>
    <script type="text/javascript">
    $(document).ready(function() {
        $('#toc').toc({
            listType: 'ul',
            noBackToTopLinks: true,
            showEffect: 'none',
            extraListGoo: ' class="nav wiki-sidenav"',
            extraListGoo2: ' class="nav"',
            showSpeed: 0,
            title: '<h4>Blog Post Explorer</h4>',
            headers: '.blogcontent h1, .blogcontent h2',
            firstItemHtml: '<li><a href="#top">Start</a></li>',
        });
        $('body').scrollspy('refresh');
    });
    </script>

      </div>

    </div><!-- row -->
  </div><!-- container 1 -->

  <div id="related">
    <h4>Other posts</h4>
    <ul class="posts">
      
        <li><span>25 Nov 2019</span> &raquo; <a href="/2019/11/evcondo/">My $6,000 Tesla Wall Connector: the story of bringing Electric Vehicle charging to a high-rise condo tower in Seattle</a></li>
      
        <li><span>25 Jun 2019</span> &raquo; <a href="/2019/06/scaling-25k/">Scaling from 2,000 to 25,000 engineers on GitHub at Microsoft</a></li>
      
        <li><span>10 Apr 2018</span> &raquo; <a href="/2018/04/seattle-network/">My home network: Ubiquiti UniFi gear, fiber gigabit Internet, CAT6 and CAT3 wiring</a></li>
      
        <li><span>28 Feb 2017</span> &raquo; <a href="/2017/02/azure-private-npm/">Deploying Node.js apps in Azure App Service using private npm feeds from Visual Studio Team Services</a></li>
      
    </ul>
  </div>

  
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'jeffwilcox';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</div><!-- container 2 -->

<div class="container">  
<hr />

<footer class="wiki-footer">
  <p class="pull-right"><a href="#top">Back to top</a></p>
  <div class="links">
    <a href="/">jeffwilcox.blog</a> |
    <a href="https://twitter.com/jeffwilcox">@jeffwilcox</a> |
    <a href="https://github.com/jeffwilcox/">github.com/jeffwilcox</a> |
    <a href="http://linkedin.com/in/jeffreywilcox">linkedin profile</a> |
    <a href="http://www.google.com/recaptcha/mailhide/d?k=01Tv_GmcqyJ7mtRaeIIZEB4w==&c=PqTaC_u8CDIyO7wQDBRbQC1w7tGtyj-TDjnJupt4zLw=">email</a> |
    <a href="http://feeds.feedburner.com/jeffwilcox">rss</a>
  </div>
  <p><small>&copy; Jeff Wilcox<br />
  <span class="muted">Disclaimer: The content on this site represents my own personal opinions and thoughts at the time of posting, and does not reflect those of my employer in any way.</span></small></p>
</footer>

</div><!-- /container -->
<script src="//az414997.vo.msecnd.net/waz/syntax/scripts/shCore.js" type="text/javascript"></script>
<script src="//az414997.vo.msecnd.net/waz/syntax/scripts/shAutoloader.js" type="text/javascript"></script>
<script type="text/javascript">
function stxpath()
{
  var args = arguments, result = [];
  for(var i = 0; i < args.length; i++) {
      result.push(args[i].replace('@', '//az414997.vo.msecnd.net/waz/syntax/scripts/'));
  }
  return result;
};
SyntaxHighlighter.autoloader.apply(null, stxpath(
  'bash shell             @shBrushBash.js',
  'c# c-sharp csharp      @shBrushCSharp.js',
  'js jscript javascript  @shBrushJScript.js',
  'text plain             @shBrushPlain.js',
  'xml xhtml xslt html    @shBrushXml.js'
));
SyntaxHighlighter.defaults['gutter'] = false;
SyntaxHighlighter.defaults['tab-size'] = 2;
SyntaxHighlighter.defaults['class-name'] = 'code';
SyntaxHighlighter.all(); //'code', false, true: tag, showGutter, showControls
</script>
<!-- Google Analytics -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-2695771-1");
pageTracker._trackPageview();
</script>
<!-- Google Analytics end -->
  </body>
</html>