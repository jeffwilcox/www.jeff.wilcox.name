<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Getting Expression Encoder 2 SP1's media player template to work with CDNs and cross-domain embedding - Jeff Wilcox</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Getting Expression Encoder 2 SP1's media player template to work with CDNs and cross-domain embedding">
    <meta name="author" content="Jeff Wilcox">
    

    <link href="http://feeds.feedburner.com/jeffwilcox" rel="alternate" title="Jeff Wilcox" type="application/atom+xml" />
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
    <link href="/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/css/jmw.css" rel="stylesheet"/>
    <script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.4.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/toc.js"></script>
    <script src="/js/jmw.js"></script>
    <link type="text/css" rel="stylesheet" href="//az414997.vo.msecnd.net/waz/syntax/styles/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="//az414997.vo.msecnd.net/waz/syntax/styles/shThemeDefault.css"/>
  </head>
<body data-spy="scroll" data-target=".wiki-sidebar">
    <div class="navbar navbar-inverse" role="navigation"><!-- formerly navbar-fixed-top -->
        <div class="navbar-inner">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">Jeff Wilcox</a>
                </div>
                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="/about/">About</a></li>
                    <li><a href="/posts/">Posts</a></li>
                    <li><a href="https://github.com/jeffwilcox">//github.com/jeffwilcox</a></li>
                    <li><a href="https://twitter.com/jeffwilcox">@jeffwilcox</a></li>
                    <li><a href="http://linkedin.com/in/jeffreywilcox">LinkedIn</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>



<div class="container">

  <div class="container">
    <div class="row">
      <div class="col-md-8">

        <div id="post">
          <h2 class="post-title"><!--<a href="/2008/11/cross-domain-encoder-media-player/">-->Getting Expression Encoder 2 SP1's media player template to work with CDNs and cross-domain embedding<!--</a>--></h2>
          <div class="pull-right">
            <a href="https://twitter.com/share" class="twitter-share-button" data-via="jeffwilcox" data-count="none">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></p>
          </div>
          <p id="date" class="muted">
            
            
            <small>
               3 November 2008
            </small>
            
            <!--
            <ul class="categories nav nav-pills">
            
            </ul>
            -->
            
          </p>

          <div class="blogcontent">
            <p>The new Silverlight 2 media player that <a href="http://www.microsoft.com/expression/try-it/default.aspx?filter=servicepacks">Expression Encoder 2 SP1</a> ships with is great. You can encode video and output Silverlight content in minutes. With SP1, when you select one of the new templates, the only bits generated are your video asset + thumbnail, a single media player .Xap file, and a sample .Html page.</p> <p>This really cuts down on the moving parts from the previous 1.0 templates that had dependencies on so many loose JavaScript files.</p> <p>I wanted to blog about my experience in case others ran into this: if you have your Xap files on a domain different than your pages, you might find that the Silverlight plugin is blank and the media player never loads. This is a by-design feature per the Silverlight HTML DOM bridge security model - but you can actually do a few things to get this to work.</p> <p>I host my Silverlight applications and media assets on a separate domain. This creates the situation where the bridge is disabled; if you would like to reference the .Xap files from different sites or enable others to embed your video player, it won't work out of the box unless you modify the &lt;object /&gt; tag or modify and rebuild the managed media player to gracefully move on in this situation.</p> <p>Here's the breakdown that I have for my web pages vs. my Silverlight assets, including the apps:</p> <p><img src="http://media.jeff.wilcox.name/blog/view/CdnXap.png"/> </p> <p>The additional parameter within the object tag will be easiest for most folks, and is probably the way that the Expression team hopes that you'll enable this scenario. I always forget things like modifying the object tags, since this isn't in the default generated HTML file that Encoder outputs, so I'm going for a more involved solution.</p> <p>Oh, and don't get me wrong: SP1 rocks. I highly recommend that you install it; I'm getting so much more use out of Encoder 2 now. If you haven't purchased Encoder... well, you really should <a href="http://www.microsoft.com/expression/try-it/default.aspx">try</a> or <a href="http://www.microsoft.com/expression/products/Purchase.aspx?key=encoder">buy</a> it. With SP1 it not only adds the nice Silverlight 2 templates, but also H.264 mobile encoding. I was able encode my screencast in H.264, and it looks great on my iPhone!</p> <h3>The HTML DOM Bridge security model in Silverlight</h3> <p>Per the <a href="http://msdn.microsoft.com/en-us/library/cc645023(VS.95).aspx">DOM bridge security model</a> in Silverlight 2, the default behavior when the .Xap is hosted on a domain different than your web page, is that the HTML DOM bridge feature will be disabled for that Silverlight application in the .Xap. The DOM bridge is used by the managed media player to get the document URI property when trying to look up relative-path video assets.</p> <p>This situation can also present itself on the same domain, when the web page author explicitly denies the HTML DOM bridge access to a plugin: if the &lt;param name="EnableHtmlAccess" value="false" /&gt; tag is present in the object tag, the DOM bridge will not work and the media player template will end up throwing an exception while trying to access the HtmlPage.Document.DocumentUri property.</p> <h3>The quick fix</h3> <p>Inside your Silverlight plugin object tag, add the <strong>EnableHtmlAccess</strong> parameter with a value of 'true'. Here is a sample embedded object tag with the parameter added:</p> <blockquote> <p>&lt;object data="data:application/x-silverlight-2," type="application/x-silverlight-2" width="685" height="448"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp; &lt;param name="source" value="http://media.cdn.com/Xaps/MediaPlayerTemplate.xap" /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp; &lt;param name="initparams" value="expression encoder generated parameters go here" /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ff0000"><strong>&lt;param name="enableHtmlAccess" value="true" /&gt;</strong></font><br />&lt;/object&gt;</p></blockquote> <h3>The source fix</h3> <p>I decided to just update the media player to not be dependent on the HTML DOM bridge feature.</p> <p>This fix assumes that you always provide the absolute URI for video assets in the playlist. Effectively it won't try any relative URI lookups when HTML DOM bridge access is not permitted. </p> <p>Thanks to the Expression team, they did a good thing and shipped the source to the media player template with the product. You will find it in <em>%programfiles%\Microsoft Expression\Encoder 2\Templates\en\SL2Standard\Source</em>. It opens with Visual Studio 2008 SP1 + the Silverlight 2 Developer Tools.</p> <p>I went ahead and rebuilt the template: whenever the C# code would try and use the HtmlPage.Document.DocumentUri getter, I would encase the code in an HtmlPage.IsEnabled check. I had to do this in just a few spots.</p> <p>One nice side effect was that I was able to chop the .Xap size down about 50K by removing the Adaptive Streaming support built into the template, since I just host my media assets over simple HTTP and do not do streaming.</p> <p>For your reference:</p> <p><strong><a href="http://media.jeff.wilcox.name/blog/code/ModifiedTemplate.zip">Download ModifiedTemplate.zip</a></strong> (69 K, solution in a Zip)<br /><strong><a href="http://www.jeff.wilcox.name/xap/2008/MediaPlayerTemplate.xap">Download MediaPlayerTemplate.xap</a></strong> (114 K, Xap)<br /><em>Note: Does not contain adaptive streaming support.</em></p> <h3>HtmlPage.IsEnabled lesson</h3> <p>You should always make sure to check the HtmlPage.IsEnabled property before attempting to access any of the HTML DOM bridge resources. This is good practice whether thinking about scenarios where the bridge is disabled, or designer tools like Cider and Blend.</p> <p><em>Disclaimer:</em> <em>I am not a member of the Expression team, this is not my area of expertise, other than being a member of the original HTML DOM bridge feature crew for Silverlight. I do not know if this was a known issue before, an expected, by-design feature, will be fixed, or anything like that.</em></p>

<h3>Live, embeddable player: Shawn Burke's PDC talk</h3>
<p>Oh, and here's Shawn Burke's excellent PDC talk. If you haven't checked out everything that was released in the Silverlight Toolkit, or heard about the release model, you should watch this. It is using my updated Xap player, so you can even embed Shawn's talk in your own blog.</p> <object data="data:application/x-silverlight-2," type="application/x-silverlight-2" width="685" height="448"><param name="source" value="http://media.jeff.wilcox.name/video/MediaPlayerTemplate.xap" /><param name="initparams" value="autoplay=False,autoload=False,enablecaptions=False,muted=False,stretchmode=0,displaytimecode=False,playlist=&lt;playList&gt;&lt;playListItems&gt;&lt;playListItem title=&quot;Shawn%20Burke%20-%20-Silverlight%20Toolkit%20talk%20at%20PDC%202008&quot; description=&quot;&quot; mediaSource=&quot;http://mschnlnine.vo.llnwd.net/d1/pdc08/WMV-HQ/PC35.wmv&quot; adaptiveStreaming=&quot;False&quot; thumbSource=&quot;http://media.jeff.wilcox.name/video/PC35_Thumb.jpg&quot; frameRate=&quot;30.00003000003&quot; width=&quot;984&quot; height=&quot;500&quot; &gt;&lt;/playListItem&gt;&lt;/playListItems&gt;&lt;/playList&gt;" />Your news reader may not permit Silverlight content. Please click-through to the original post to see this plugin.  You may also not have Silverlight 2 installed on your machine:<br /> <a href="http://go2.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"><img src="http://go2.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none" /></a> </object> <p>Hope this helps.</p>

          </div>
        </div>

      </div>

      <div class="col-md-4 wiki-sidebaZr" style="margin-top:18px">
            
    <p style="position: relative; width: 100%; height:195px; min-height: 120px; background: url(/jeffwilcox.png) no-repeat"></p>
    

    
<p class="lead" style="font-size:20px">
  Jeff Wilcox is a Software Engineer at Microsoft in the
  Open Source Programs Office (OSPO), helping Microsoft engineers
  use, contribute to and release open source at scale.
  
</p>
<!--
<p>
  Jeff is an alumnus of the University of Michigan, Ann Arbor, with
  a degree in Computer Science.
</p>
-->
    <p><a href="https://twitter.com/jeffwilcox" class="twitter-follow-button" data-show-count="true" data-size="medium">Follow @jeffwilcox</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></p>

    
       <div style="margin-top: 24px">
           <!-- small -->
               
           <!-- /small -->
       </div>
    

    <div id="toc" class="wiki-sidebar" style="margin-top: 24px">
    </div>
    <script type="text/javascript">
    $(document).ready(function() {
        $('#toc').toc({
            listType: 'ul',
            noBackToTopLinks: true,
            showEffect: 'none',
            extraListGoo: ' class="nav wiki-sidenav"',
            extraListGoo2: ' class="nav"',
            showSpeed: 0,
            title: '<h4>Blog Post Explorer</h4>',
            headers: '.blogcontent h1, .blogcontent h2',
            firstItemHtml: '<li><a href="#top">Start</a></li>',
        });
        $('body').scrollspy('refresh');
    });
    </script>

      </div>

    </div><!-- row -->
  </div><!-- container 1 -->

  <div id="related">
    <h4>Other posts</h4>
    <ul class="posts">
      
        <li><span>25 Nov 2019</span> &raquo; <a href="/2019/11/evcondo/">My $6,000 Tesla Wall Connector: the story of bringing Electric Vehicle charging to a high-rise condo tower in Seattle</a></li>
      
        <li><span>25 Jun 2019</span> &raquo; <a href="/2019/06/scaling-25k/">Scaling from 2,000 to 25,000 engineers on GitHub at Microsoft</a></li>
      
        <li><span>10 Apr 2018</span> &raquo; <a href="/2018/04/seattle-network/">My home network: Ubiquiti UniFi gear, fiber gigabit Internet, CAT6 and CAT3 wiring</a></li>
      
        <li><span>28 Feb 2017</span> &raquo; <a href="/2017/02/azure-private-npm/">Deploying Node.js apps in Azure App Service using private npm feeds from Visual Studio Team Services</a></li>
      
    </ul>
  </div>

  
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'jeffwilcox';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</div><!-- container 2 -->

<div class="container">  
<hr />

<footer class="wiki-footer">
  <p class="pull-right"><a href="#top">Back to top</a></p>
  <div class="links">
    <a href="/">jeffwilcox.blog</a> |
    <a href="https://twitter.com/jeffwilcox">@jeffwilcox</a> |
    <a href="https://github.com/jeffwilcox/">github.com/jeffwilcox</a> |
    <a href="http://linkedin.com/in/jeffreywilcox">linkedin profile</a> |
    <a href="http://www.google.com/recaptcha/mailhide/d?k=01Tv_GmcqyJ7mtRaeIIZEB4w==&c=PqTaC_u8CDIyO7wQDBRbQC1w7tGtyj-TDjnJupt4zLw=">email</a> |
    <a href="http://feeds.feedburner.com/jeffwilcox">rss</a>
  </div>
  <p><small>&copy; Jeff Wilcox<br />
  <span class="muted">Disclaimer: The content on this site represents my own personal opinions and thoughts at the time of posting, and does not reflect those of my employer in any way.</span></small></p>
</footer>

</div><!-- /container -->
<script src="//az414997.vo.msecnd.net/waz/syntax/scripts/shCore.js" type="text/javascript"></script>
<script src="//az414997.vo.msecnd.net/waz/syntax/scripts/shAutoloader.js" type="text/javascript"></script>
<script type="text/javascript">
function stxpath()
{
  var args = arguments, result = [];
  for(var i = 0; i < args.length; i++) {
      result.push(args[i].replace('@', '//az414997.vo.msecnd.net/waz/syntax/scripts/'));
  }
  return result;
};
SyntaxHighlighter.autoloader.apply(null, stxpath(
  'bash shell             @shBrushBash.js',
  'c# c-sharp csharp      @shBrushCSharp.js',
  'js jscript javascript  @shBrushJScript.js',
  'text plain             @shBrushPlain.js',
  'xml xhtml xslt html    @shBrushXml.js'
));
SyntaxHighlighter.defaults['gutter'] = false;
SyntaxHighlighter.defaults['tab-size'] = 2;
SyntaxHighlighter.defaults['class-name'] = 'code';
SyntaxHighlighter.all(); //'code', false, true: tag, showGutter, showControls
</script>
<!-- Google Analytics -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-2695771-1");
pageTracker._trackPageview();
</script>
<!-- Google Analytics end -->
  </body>
</html>